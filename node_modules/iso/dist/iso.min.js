"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(a,t,r){if(t)e(a.prototype,t);if(r)e(a,r);return a}}();function _classCallCheck(e,a){if(!(e instanceof a)){throw new TypeError("Cannot call a class as a function")}}var escapeTextForBrowser=require("escape-html");var defaultConfiguration={markupClassName:"___iso-html___",markupElement:"div",dataClassName:"___iso-state___",dataElement:"div",keyPrefix:""};var each=function e(a,t){return Array.prototype.forEach.call(a,t)};var parse=function a(e,t){return JSON.parse(e.getAttribute(t))};var setDefaults=function t(e){e.markupClassName=e.markupClassName||defaultConfiguration.markupClassName;e.markupElement=e.markupElement||defaultConfiguration.markupElement;e.dataClassName=e.dataClassName||defaultConfiguration.dataClassName;e.dataElement=e.dataElement||defaultConfiguration.dataElement;e.keyPrefix=e.keyPrefix||defaultConfiguration.keyPrefix};var Iso=function(){function e(){var a=arguments.length<=0||arguments[0]===undefined?defaultConfiguration:arguments[0];_classCallCheck(this,e);setDefaults(a);this.markupClassName=a.markupClassName;this.markupElement=a.markupElement;this.dataClassName=a.dataClassName;this.dataElement=a.dataElement;this.keyPrefix=a.keyPrefix;this.html=[];this.data=[]}_createClass(e,[{key:"add",value:function a(e){var a=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var t=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var r=escapeTextForBrowser(JSON.stringify(a));var n=escapeTextForBrowser(JSON.stringify(t));this.html.push(e);this.data.push({state:r,meta:n});return this}},{key:"render",value:function t(){var e=this;var a=this.html.reduce(function(a,t,r){return a+("<"+e.markupElement+' class="'+e.markupClassName+'" data-key="'+e.keyPrefix+"_"+r+'">'+t+"</"+e.markupElement+">")},"");var t=this.data.reduce(function(a,t,r){var n=t.state;var u=t.meta;return a+("<"+e.dataElement+' class="'+e.dataClassName+'" data-key="'+e.keyPrefix+"_"+r+'" data-meta="'+u+'" data-state="'+n+'"></'+e.dataElement+">")},"");return"\n"+a+"\n"+t+"\n"}}],[{key:"render",value:function r(a){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var n=arguments.length<=3||arguments[3]===undefined?defaultConfiguration:arguments[3];return new e(n).add(a,t,r).render()}},{key:"bootstrap",value:function n(e){var a=arguments.length<=1||arguments[1]===undefined?defaultConfiguration:arguments[1];setDefaults(a);if(!e){return}var t=document.querySelectorAll("."+a.markupClassName);var r=document.querySelectorAll("."+a.dataClassName);var n={};each(r,function(e){var a=parse(e,"data-meta");var t=parse(e,"data-state");n[e.getAttribute("data-key")]={meta:a,state:t}});each(t,function(a){var t=a.getAttribute("data-key");if(!n[t]){return}var r=n[t];var u=r.meta;var s=r.state;e(s,u,a)});n=null}},{key:"on",value:function u(a,t,r){var n=arguments.length<=3||arguments[3]===undefined?defaultConfiguration:arguments[3];setDefaults(n);e.bootstrap(function(e,n,u){if(n[a]&&n[a]===t){r(e,n,u)}},n)}}]);return e}();exports["default"]=Iso;module.exports=exports["default"];
